/*
  Stockfish, a UCI chess playing engine derived from Glaurung 2.1
  Copyright (C) 2004-2008 Tord Romstad (Glaurung author)
  Copyright (C) 2008-2015 Marco Costalba, Joona Kiiski, Tord Romstad
  Copyright (C) 2015-2017 Marco Costalba, Joona Kiiski, Gary Linscott, Tord Romstad

  Stockfish is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  Stockfish is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include <algorithm>

#include "types.h"

Value PieceValue[VARIANT_NB][PHASE_NB][PIECE_NB] = {
{
  { VALUE_ZERO, PawnValueMg, KnightValueMg, BishopValueMg, RookValueMg, QueenValueMg },
  { VALUE_ZERO, PawnValueEg, KnightValueEg, BishopValueEg, RookValueEg, QueenValueEg },
},
#ifdef ANTI
{
  { VALUE_ZERO, PawnValueMgAnti, KnightValueMgAnti, BishopValueMgAnti, RookValueMgAnti, QueenValueMgAnti, KingValueMgAnti },
  { VALUE_ZERO, PawnValueEgAnti, KnightValueEgAnti, BishopValueEgAnti, RookValueEgAnti, QueenValueEgAnti, KingValueEgAnti },
},
#endif
#ifdef ATOMIC
{
  { VALUE_ZERO, PawnValueMgAtomic, KnightValueMgAtomic, BishopValueMgAtomic, RookValueMgAtomic, QueenValueMgAtomic },
  { VALUE_ZERO, PawnValueEgAtomic, KnightValueEgAtomic, BishopValueEgAtomic, RookValueEgAtomic, QueenValueEgAtomic },
},
#endif
#ifdef CRAZYHOUSE
{
  { VALUE_ZERO, PawnValueMgHouse, KnightValueMgHouse, BishopValueMgHouse, RookValueMgHouse, QueenValueMgHouse },
  { VALUE_ZERO, PawnValueEgHouse, KnightValueEgHouse, BishopValueEgHouse, RookValueEgHouse, QueenValueEgHouse },
},
#endif
#ifdef HORDE
{
  { VALUE_ZERO, PawnValueMgHorde, KnightValueMgHorde, BishopValueMgHorde, RookValueMgHorde, QueenValueMgHorde, KingValueMgHorde },
  { VALUE_ZERO, PawnValueEgHorde, KnightValueEgHorde, BishopValueEgHorde, RookValueEgHorde, QueenValueEgHorde, KingValueEgHorde },
},
#endif
#ifdef KOTH
{
  { VALUE_ZERO, PawnValueMgHill, KnightValueMgHill, BishopValueMgHill, RookValueMgHill, QueenValueMgHill },
  { VALUE_ZERO, PawnValueEgHill, KnightValueEgHill, BishopValueEgHill, RookValueEgHill, QueenValueEgHill },
},
#endif
#ifdef LOSERS
{
  { VALUE_ZERO, PawnValueMgLosers, KnightValueMgLosers, BishopValueMgLosers, RookValueMgLosers, QueenValueMgLosers },
  { VALUE_ZERO, PawnValueEgLosers, KnightValueEgLosers, BishopValueEgLosers, RookValueEgLosers, QueenValueEgLosers },
},
#endif
#ifdef RACE
{
  { VALUE_ZERO, VALUE_ZERO, KnightValueMgRace, BishopValueMgRace, RookValueMgRace, QueenValueMgRace },
  { VALUE_ZERO, VALUE_ZERO, KnightValueEgRace, BishopValueEgRace, RookValueEgRace, QueenValueEgRace },
},
#endif
#ifdef RELAY
{
  { VALUE_ZERO, PawnValueMg, KnightValueMg, BishopValueMg, RookValueMg, QueenValueMg },
  { VALUE_ZERO, PawnValueEg, KnightValueEg, BishopValueEg, RookValueEg, QueenValueEg },
},
#endif
#ifdef THREECHECK
{
  { VALUE_ZERO, PawnValueMgThreeCheck, KnightValueMgThreeCheck, BishopValueMgThreeCheck, RookValueMgThreeCheck, QueenValueMgThreeCheck },
  { VALUE_ZERO, PawnValueEgThreeCheck, KnightValueEgThreeCheck, BishopValueEgThreeCheck, RookValueEgThreeCheck, QueenValueEgThreeCheck },
},
#endif
};

namespace PSQT {

#define S(mg, eg) make_score(mg, eg)

// Bonus[PieceType][Square / 2] contains Piece-Square scores. For each piece
// type on a given square a (middlegame, endgame) score pair is assigned. Table
// is defined for files A..D and white side: it is symmetric for black side and
// second half of the files.
const Score Bonus[VARIANT_NB][PIECE_TYPE_NB][RANK_NB][int(FILE_NB) / 2] = {
  {
    { },
    { // Pawn
      { S(  0, 0), S(  0, 0), S(  0, 0), S( 0, 0) },
      { S(-11, 7), S(  6,-4), S(  7, 8), S( 3,-2) },
      { S(-18,-4), S( -2,-5), S( 19, 5), S(24, 4) },
      { S(-17, 3), S( -9, 3), S( 20,-8), S(35,-3) },
      { S( -6, 8), S(  5, 9), S(  3, 7), S(21,-6) },
      { S( -6, 8), S( -8,-5), S( -6, 2), S(-2, 4) },
      { S( -4, 3), S( 20,-9), S( -8, 1), S(-4,18) }
    },
    { // Knight
     { S(-144, -98), S(-96,-82), S(-80,-46), S(-73,-14) },
     { S( -83, -69), S(-43,-54), S(-21,-17), S(-10,  9) },
     { S( -71, -50), S(-22,-39), S(  0, -7), S(  9, 28) },
     { S( -25, -41), S( 18,-25), S( 43,  6), S( 47, 38) },
     { S( -26, -46), S( 16,-25), S( 38,  3), S( 50, 40) },
     { S( -11, -54), S( 37,-38), S( 56, -7), S( 65, 27) },
     { S( -62, -65), S(-17,-50), S(  5,-24), S( 14, 13) },
     { S(-194,-109), S(-66,-89), S(-42,-50), S(-29,-13) }
    },
    { // Bishop
     { S(-44,-58), S(-13,-31), S(-25,-37), S(-34,-19) },
     { S(-20,-34), S( 20, -9), S( 12,-14), S(  1,  4) },
     { S( -9,-23), S( 27,  0), S( 21, -3), S( 11, 16) },
     { S(-11,-26), S( 28, -3), S( 21, -5), S( 10, 16) },
     { S(-11,-26), S( 24, -4), S( 16, -7), S(  9, 14) },
     { S(-17,-24), S( 16, -2), S( 12,  0), S(  2, 13) },
     { S(-23,-34), S( 17,-10), S(  6,-12), S( -2,  6) },
     { S(-35,-55), S(-11,-32), S(-19,-36), S(-29,-17) }
    },
    { // Rook
      { S(-25, 0), S(-16, 0), S(-16, 0), S(-9, 0) },
      { S(-21, 0), S( -8, 0), S( -3, 0), S( 0, 0) },
      { S(-21, 0), S( -9, 0), S( -4, 0), S( 2, 0) },
      { S(-22, 0), S( -6, 0), S( -1, 0), S( 2, 0) },
      { S(-22, 0), S( -7, 0), S(  0, 0), S( 1, 0) },
      { S(-21, 0), S( -7, 0), S(  0, 0), S( 2, 0) },
      { S(-12, 0), S(  4, 0), S(  8, 0), S(12, 0) },
      { S(-23, 0), S(-15, 0), S(-11, 0), S(-5, 0) }
    },
    { // Queen
     { S( 0,-71), S(-4,-56), S(-3,-42), S(-1,-29) },
     { S(-4,-56), S( 6,-30), S( 9,-21), S( 8, -5) },
     { S(-2,-39), S( 6,-17), S( 9, -8), S( 9,  5) },
     { S(-1,-29), S( 8, -5), S(10,  9), S( 7, 19) },
     { S(-3,-27), S( 9, -5), S( 8, 10), S( 7, 21) },
     { S(-2,-40), S( 6,-16), S( 8,-10), S(10,  3) },
     { S(-2,-55), S( 7,-30), S( 7,-21), S( 6, -6) },
     { S(-1,-74), S(-4,-55), S(-1,-43), S( 0,-30) }
    },
    { // King
     { S(267,  0), S(320, 48), S(270, 75), S(195, 84) },
     { S(264, 43), S(304, 92), S(238,143), S(180,132) },
     { S(200, 83), S(245,138), S(176,167), S(110,165) },
     { S(177,106), S(185,169), S(148,169), S(110,179) },
     { S(149,108), S(177,163), S(115,200), S( 66,203) },
     { S(118, 95), S(159,155), S( 84,176), S( 41,174) },
     { S( 86, 50), S(128, 99), S( 63,122), S( 18,139) },
     { S( 63,  9), S( 89, 55), S( 47, 80), S(  0, 90) }
    }
  },
#ifdef ANTI
  {
    { },
    { // Pawn
      { S(  0,  0), S(  0,  0), S(  0,  0), S( 0,  0) },
      { S( 30,-21), S( 13,-12), S( 33, 26), S(21,  4) },
      { S(-27,-58), S(-17,-52), S( 16,-32), S(16,-22) },
      { S( -6,-23), S( -2, 25), S( 35, 24), S(26, 20) },
      { S(-25, 26), S( 18, 27), S( 10, 16), S(31, 50) },
      { S(-22, 19), S(  6,-21), S( -1,  0), S( 9,-11) },
      { S( -2,-30), S( 22,  4), S(-12, 11), S(11, 10) }
    },
    { // Knight
      { S(-150,-106), S(-111, -86), S(-83,-37), S(-91,-20) },
      { S( -81, -52), S( -37, -43), S(-40,  2), S( 10,  7) },
      { S( -65, -22), S(   0, -32), S(  2,  3), S(  3, 49) },
      { S( -49, -32), S(  35, -36), S( 32, -5), S( 40,  5) },
      { S( -14, -70), S(  21,  -5), S( 45, 38), S( 43, 34) },
      { S(   1, -50), S(  38, -67), S( 41,-14), S( 85,  2) },
      { S( -72, -86), S( -39, -81), S( 20,-28), S( 39,  9) },
      { S(-198,-103), S( -96,-100), S(-16,-60), S(-10,-28) }
    },
    { // Bishop
      { S(-73,-53), S(-38,-39), S(-34,-32), S(-27,-54) },
      { S(-33,-54), S( 17,-18), S( -2,-17), S(-12,-14) },
      { S(-29,-45), S(  2,  0), S( 24,  0), S( 11, -9) },
      { S(-21,-32), S( 42,-13), S( -1,-10), S(-14,-14) },
      { S(  0,-18), S( 29,-19), S(-14,-18), S(  2,-15) },
      { S(-32,-46), S( 23, -7), S(  0,  4), S(-18,  9) },
      { S(-28,-32), S( 22,-47), S(  6,-12), S(-12,  7) },
      { S(-61,-77), S( -1,-46), S(-29,-48), S(-47,-24) }
    },
    { // Rook
      { S( -2, 14), S( -4,-49), S(  0,  2), S(-14, -3) },
      { S(-31,  8), S( 15,-18), S( -8,  2), S( 27,  2) },
      { S(-28,-10), S( -2, 17), S(-16,-30), S( -2,  4) },
      { S(-16,-13), S( -4, 13), S(  0,-18), S(  7,-30) },
      { S(-28, 15), S(-20, -6), S(  3,  1), S( 17,  4) },
      { S(-31,  5), S(  1,  0), S(  1, -9), S( -7, 15) },
      { S( 11, -2), S( -1, -5), S( 23, 13), S( 14, 17) },
      { S( -6,  2), S( -9, 31), S( 20,  4), S(  2, -2) }
    },
    { // Queen
      { S(-18,-76), S(-20,-73), S(-13,-15), S( 7,-37) },
      { S(  0,-54), S(  6,-53), S( -1,-21), S(19,-33) },
      { S(-12,-52), S(  8,-15), S( 14,-11), S(10,  8) },
      { S( 13,  7), S(  0, -8), S(-22, 33), S(14,  9) },
      { S( 12,-47), S( 11,-14), S( 12, -7), S(22, 35) },
      { S( 12,-50), S( 17,-12), S( 26,-21), S( 0,  5) },
      { S( 13,-73), S(  6,-28), S( 14,-41), S(-6,  9) },
      { S(-11,-82), S( -4,-68), S( -8,-32), S( 3,-38) }
    },
    { // King
      { S(291, 17), S(292, 75), S(297, 90), S(240,128) },
      { S(269, 69), S(297, 91), S(259,192), S(172,168) },
      { S(245,115), S(267,161), S(191,194), S( 91,158) },
      { S(210,124), S(227,179), S(183,209), S(158,251) },
      { S(155,134), S(187,212), S(128,217), S( 79,249) },
      { S(163, 98), S(193,165), S(102,198), S( 77,205) },
      { S(130, 79), S(163,123), S( 84,128), S( 51,145) },
      { S( 85, 42), S(121, 73), S( 60, 85), S(  4,118) }
    }
  },
#endif
#ifdef ATOMIC
  {
    { },
    { // Pawn
      { S(  0, 0), S(  0,  0), S(  0, 0), S( 0, 0) },
      { S( -9,12), S(  7, -4), S( 12, 6), S( 6,-3) },
      { S(-18,-6), S(  0,-10), S( 18, 4), S(23, 6) },
      { S(-15,-1), S( -7,  1), S( 21,-7), S(36,-4) },
      { S(-10, 7), S(  4,  7), S(  8, 9), S(26,-4) },
      { S(-13,10), S( -5, -3), S( -3, 2), S( 1, 7) },
      { S( -2,-1), S( 16, -5), S( -6, 2), S(-3,28) }
    },
    { // Knight
      { S(-143, -97), S(-96,-82), S(-80,-46), S(-73,-14) },
      { S( -83, -69), S(-43,-55), S(-21,-17), S(-10,  9) },
      { S( -71, -50), S(-22,-39), S(  0, -8), S(  9, 28) },
      { S( -25, -41), S( 18,-25), S( 43,  7), S( 47, 38) },
      { S( -26, -46), S( 16,-25), S( 38,  2), S( 50, 41) },
      { S( -11, -55), S( 37,-38), S( 56, -8), S( 71, 27) },
      { S( -62, -64), S(-17,-50), S(  5,-24), S( 14, 13) },
      { S(-195,-110), S(-66,-90), S(-42,-50), S(-29,-13) }
    },
    { // Bishop
      { S(-54,-68), S(-23,-40), S(-35,-46), S(-44,-28) },
      { S(-30,-43), S( 10,-17), S(  2,-23), S( -9, -5) },
      { S(-19,-32), S( 17, -9), S( 11,-13), S(  1,  8) },
      { S(-21,-36), S( 18,-13), S( 11,-15), S(  0,  7) },
      { S(-21,-36), S( 14,-14), S(  6,-17), S( -1,  3) },
      { S(-27,-35), S(  6,-13), S(  2,-10), S( -8,  1) },
      { S(-33,-44), S(  7,-21), S( -4,-22), S(-12, -4) },
      { S(-45,-65), S(-21,-42), S(-29,-46), S(-39,-27) }
    },
    { // Rook
      { S(-25, 0), S(-16, 0), S(-16, 0), S(-9, 0) },
      { S(-21, 0), S( -8, 0), S( -3, 0), S( 0, 0) },
      { S(-21, 0), S( -9, 0), S( -4, 0), S( 2, 0) },
      { S(-22, 0), S( -6, 0), S( -1, 0), S( 2, 0) },
      { S(-22, 0), S( -7, 0), S(  0, 0), S( 1, 0) },
      { S(-21, 0), S( -7, 0), S(  0, 0), S( 2, 0) },
      { S(-12, 0), S(  4, 0), S(  8, 0), S(12, 0) },
      { S(-23, 0), S(-15, 0), S(-11, 0), S(-5, 0) }
    },
    { // Queen
      { S( 0,-70), S(-3,-57), S(-4,-41), S(-1,-29) },
      { S(-4,-58), S( 6,-30), S( 9,-21), S( 8, -4) },
      { S(-2,-39), S( 6,-17), S( 9, -7), S( 9,  5) },
      { S(-1,-29), S( 8, -5), S(10,  9), S( 7, 17) },
      { S(-3,-27), S( 9, -5), S( 8, 10), S( 7, 23) },
      { S(-2,-40), S( 6,-16), S( 8,-11), S(10,  3) },
      { S(-2,-54), S( 7,-30), S( 7,-21), S( 6, -7) },
      { S(-1,-75), S(-4,-54), S(-1,-44), S( 0,-30) }
    },
    { // King
      { S(260,  0), S(313, 48), S(263, 75), S(188, 84) },
      { S(258, 42), S(298, 91), S(232,142), S(174,131) },
      { S(195, 81), S(240,136), S(171,167), S(105,163) },
      { S(173,103), S(181,166), S(144,166), S(106,176) },
      { S(146,104), S(174,159), S(112,196), S( 63,199) },
      { S(116, 90), S(157,150), S( 82,171), S( 39,169) },
      { S( 85, 44), S(127, 93), S( 62,114), S( 17,133) },
      { S( 63,  2), S( 89, 48), S( 47, 73), S(  0, 83) }
    }
  },
#endif
#ifdef CRAZYHOUSE
  {
    { },
    { // Pawn
      { S(  0,  0), S(  0, 0), S(  0,  0), S( 0, 0) },
      { S( -4,  4), S( -5,-1), S( 11, 18), S(-6, 5) },
      { S(-20,-23), S( -5,-1), S( 32, -2), S(29, 4) },
      { S(-26,  4), S(-15,-8), S( 13, -9), S(19,-5) },
      { S(  0, 13), S(  0, 9), S(  4,-12), S(43,-5) },
      { S(-18, 25), S( -1, 2), S(-10, -9), S( 6, 2) },
      { S(-13, 12), S( 28,-9), S( -6,-14), S( 0,19) }
    },
    { // Knight
      { S(-132,-159), S(-309, -68), S(-117, -37), S( -79,-20) },
      { S( -91,-153), S( -24, -78), S( -80,  -4), S(-129, 62) },
      { S( -28, -18), S( -59, -11), S( -17,  39), S( -10,-50) },
      { S( -17, -56), S(  85, -20), S(  75,  28), S(  95, 20) },
      { S(  91, -53), S(  38, -60), S(  -7,  60), S( 115, 90) },
      { S(  20,  -3), S(  88,-102), S(  33, -71), S(  57,  2) },
      { S(-119, -48), S( -17, -13), S( -15, -56), S(  24,-60) },
      { S(-222,-103), S( -84, -68), S(-126,-112), S(  73, 38) }
    },
    { // Bishop
      { S(-35,-68), S(-24,-36), S(-97,-47), S(-33, -8) },
      { S(-48,-49), S(  2, -2), S( 13,-35), S( 19, -7) },
      { S(-11,-20), S( 17,  5), S( 37,  1), S( 31, 22) },
      { S(  5,-11), S( 28, -8), S( 26,-23), S( 15,  6) },
      { S(  2,-43), S( 32, -1), S( -1,-24), S(  6,  7) },
      { S(-27,-59), S(  7, -7), S(-15,-10), S(-26,-13) },
      { S(-44,-43), S(  4,-31), S(  0,-19), S(-20,-13) },
      { S(-57,-51), S( -8,-38), S(-22,-53), S(-40,-30) }
    },
    { // Rook
      { S(-25, 0), S(-16, 0), S(-16, 0), S(-9, 0) },
      { S(-21, 0), S( -8, 0), S( -3, 0), S( 0, 0) },
      { S(-21, 0), S( -9, 0), S( -4, 0), S( 2, 0) },
      { S(-22, 0), S( -6, 0), S( -1, 0), S( 2, 0) },
      { S(-22, 0), S( -7, 0), S(  0, 0), S( 1, 0) },
      { S(-21, 0), S( -7, 0), S(  0, 0), S( 2, 0) },
      { S(-12, 0), S(  4, 0), S(  8, 0), S(12, 0) },
      { S(-23, 0), S(-15, 0), S(-11, 0), S(-5, 0) }
    },
    { // Queen
      { S( 0,-70), S(-3,-57), S(-4,-41), S(-1,-29) },
      { S(-4,-58), S( 6,-30), S( 9,-21), S( 8, -4) },
      { S(-2,-39), S( 6,-17), S( 9, -7), S( 9,  5) },
      { S(-1,-29), S( 8, -5), S(10,  9), S( 7, 17) },
      { S(-3,-27), S( 9, -5), S( 8, 10), S( 7, 23) },
      { S(-2,-40), S( 6,-16), S( 8,-11), S(10,  3) },
      { S(-2,-54), S( 7,-30), S( 7,-21), S( 6, -7) },
      { S(-1,-75), S(-4,-54), S(-1,-44), S( 0,-30) }
    },
    { // King
      { S(320,212), S(474,410), S(237, 64), S(133, 65) },
      { S(247,107), S(321, 77), S(292, 50), S(191, -4) },
      { S(198, 19), S(281, 79), S(231, 91), S(141, 87) },
      { S(263, 91), S(223,190), S(157,200), S(242,145) },
      { S(177,132), S(205,187), S(143,224), S( 94,227) },
      { S(147,118), S(188,178), S(113,199), S( 70,197) },
      { S(116, 72), S(158,121), S( 93,142), S( 48,161) },
      { S( 94, 30), S(120, 76), S( 78,101), S( 31,111) }
    }
  },
#endif
#ifdef HORDE
  {
    { },
    { // Pawn
      { S( -24,-99), S(-40,-115), S(-46, -63), S( 69,  -8) },
      { S( -48,-57), S( 40, -32), S(-24, -26), S( 41, -20) },
      { S(-120,-62), S( 25, -19), S(-18, -19), S( 15,  17) },
      { S( -30,-30), S( 42,  23), S(  0,   3), S( 76,  26) },
      { S( -14,-30), S( 50,   4), S( -9,  44), S( 33,  52) },
      { S(  -1, 29), S(-11,   1), S( 30,  47), S( 28,  56) },
      { S(   1, 18), S( 33,  55), S( 63,  29), S( 31,  20) },
    },
    { // Knight
      { S(-131, -94), S(-95, -77), S(-41,-26), S(-66, -8) },
      { S(-108, -77), S(-42, -61), S(-11,-58), S( 13, 10) },
      { S( -70, -59), S(-10, -40), S(-15,-19), S(  9, 23) },
      { S( -43, -38), S(  9, -60), S( 54, 20), S( 55, 31) },
      { S( -31, -43), S( -2, -12), S( 21, -5), S( 53, 22) },
      { S(   6, -60), S( 72, -37), S( 34,-11), S( 77,  7) },
      { S( -53, -68), S(-18, -50), S( 11,-46), S( 11,  2) },
      { S(-204,-131), S(-50,-112), S(-29,-47), S( -6,-19) }
    },
    { // Bishop
      { S(-53,-49), S(-24,-54), S( -2,-46), S(-25,-14) },
      { S(-41,-61), S(  7,-12), S(  5, -9), S(-38,-21) },
      { S(-45,-35), S( -3, -1), S(  2,  6), S(-19, 14) },
      { S(-40,-51), S( 31, -9), S( 51,  4), S(  7,-19) },
      { S(  2,-46), S(  5, -1), S(  4,-43), S( 11, 19) },
      { S( -9,-61), S(-10, -7), S(-12,-17), S( -6, 11) },
      { S(-35,-26), S( 28,-41), S( 16,-39), S( -8, -5) },
      { S(-53,-67), S(-31,-53), S(-29,-67), S(-14,  4) }
    },
    { // Rook
      { S(-23, 20), S(-46, 23), S(-41,-16), S(-32,-19) },
      { S(-52, 21), S(-32, -1), S(-21,-12), S( 11, 14) },
      { S( 11, 15), S(-12,-13), S( -8,-16), S( -8,-25) },
      { S( 18, 48), S(-21, -2), S( 30,-33), S(-21,  6) },
      { S( -3, 32), S( -1,-18), S(-11, -2), S(  3,-29) },
      { S(  0,  0), S(-14,-17), S( -4,-19), S(  6,-15) },
      { S(  2,-19), S(-27, -1), S(-31, 21), S( 30, -5) },
      { S(  0,-33), S(-38, 16), S(-27,-24), S( -2, 20) }
    },
    { // Queen
      { S(  5,-55), S( -1,-65), S(-19,-40), S(  6,-26) },
      { S( 24,-58), S( 11, -9), S(  9,-28), S(-26,-17) },
      { S( 12,-45), S(-21,-15), S( -4, 19), S(  0,  4) },
      { S( 17,-54), S( 18,  4), S( 22,-11), S( -5, 10) },
      { S( 17,  1), S( 28,-16), S(-12,  5), S( 15, 10) },
      { S(-16,-21), S( -8,-20), S(  5, -9), S( 42, 13) },
      { S(-10,-29), S( 12,-35), S(  3,-30), S(-25, -6) },
      { S( 14,-31), S(-10,-44), S( 11,-63), S( -7,-21) }
    },
    { // King
      { S(156, 72), S(381, 37), S(398, 90), S(488,103) },
      { S(226, 36), S(305,143), S(327,177), S(267,234) },
      { S(285,  0), S(266,121), S(254, 61), S(178,172) },
      { S(230,173), S(308,233), S(158,230), S(-44, 68) },
      { S(146,106), S(268,186), S(156,236), S( 11,-67) },
      { S(211,142), S(202,166), S( 86,165), S(170,275) },
      { S( 41,-24), S(205,103), S(216,136), S(-54,123) },
      { S(105, 58), S(207,-19), S( 75, 59), S(-26, 57) }
    }
  },
#endif
#ifdef KOTH
  {
    { },
    { // Pawn
      { S(  0,  0), S(  0,  0), S(  0, 0), S(  0,  0) },
      { S(  5,  5), S( -1,-21), S(-25, 4), S(-33,-32) },
      { S(-27,-14), S( 25,  3), S( 26,-5), S(-19,-11) },
      { S(-27, -3), S( 32,-10), S( 61,17), S( 91,  9) },
      { S(-28, -5), S( 12, 30), S( 35,41), S( 76,  0) },
      { S( -7, 26), S(-18, -8), S(-17,-5), S( 24, 12) },
      { S( 20, 44), S( 24,-20), S( 12,41), S(  9, 14) }
    },
    { // Knight
      { S(-128, -93), S(-139,-110), S(-89,-33), S(-74,  3) },
      { S( -91, -53), S( -63, -73), S(-26,-15), S(-10,-23) },
      { S( -59, -41), S( -14, -36), S( 17,-32), S( 21, 49) },
      { S(   0, -55), S(   2, -31), S( 32, 13), S( 87, 45) },
      { S( -46, -35), S(  35, -12), S( 43, 16), S( 86, 39) },
      { S( -26, -13), S(  23, -88), S( 63,  3), S( 87, 41) },
      { S( -99, -79), S( -15, -25), S(  7,-24), S(  2, 17) },
      { S(-194,-139), S( -43,-114), S(-62,-25), S(-32,-22) }
    },
    { // Bishop
      { S(-16,-31), S( -9,-30), S(-59,-72), S(-38, -9) },
      { S(-40,-49), S( 37,-52), S( -3, -9), S(-13,-11) },
      { S(-26, -7), S( 27, 25), S( 18,-34), S( 14,-10) },
      { S(-10,-29), S( 25,-27), S( 37,-25), S(  5, 16) },
      { S(-42,-28), S( 18,-54), S( 39,-21), S(-12,  9) },
      { S(-45,-35), S( 31,-13), S( 10,-18), S(-12,-12) },
      { S(-43,-36), S( -8,-37), S(-19, -8), S(-16, 27) },
      { S(-97,-61), S(-21,-29), S(-23,-69), S(-43,  5) }
    },
    { // Rook
      { S(-57,-20), S(-12,  3), S( 36, -5), S( 41,  0) },
      { S(-20, 33), S(  0, 66), S( -3, 11), S( 20,-43) },
      { S(-52,  1), S( -9, 44), S(-17,-14), S( 40,-11) },
      { S(-11,  0), S(  2,-26), S(  7,  2), S( 35, -8) },
      { S(-14, 20), S(-14,  6), S( 11,-33), S( 29,-18) },
      { S(-23,-38), S( 33, 10), S(-12,-15), S(-16,-13) },
      { S(  0,-13), S(-17, 29), S( 17,  7), S( 26,-26) },
      { S(-27,  7), S(-34, 12), S(-23,-21), S(  1, -5) }
    },
    { // Queen
      { S(-32,-57), S( 12,-84), S(-17,-27), S(  8,-34) },
      { S(-17,-43), S(-22,-28), S( -3,-27), S( 22,  4) },
      { S( -7,-73), S( 36,-16), S( 27,  1), S(  9, -9) },
      { S(-17, -2), S( 25, 16), S( 10,-25), S( 21, 56) },
      { S( -8,-25), S(-20, 19), S( 15, 18), S(  7, 31) },
      { S( 36,-28), S( 25,-49), S( 24,  0), S( 10, 20) },
      { S( 37,-48), S(  3,-25), S(  2,-25), S(-10, 23) },
      { S(-43,-68), S(  5,-39), S(-14,-34), S( 13,-29) }
    },
    { // King
      { S(209, 35), S(379,-31), S(386,187), S(361, 65) },
      { S(256, 26), S(294, 74), S(329,235), S(306,430) },
      { S(253, 37), S(297,109), S(269, 86), S(280,191) },
      { S(246,169), S(253,242), S(168,217), S(-21, 25) },
      { S(140,130), S(206,197), S(140,221), S(-11,-16) },
      { S(197,107), S(181,213), S(140,152), S(195,270) },
      { S( 82,  1), S(158,149), S( 75,131), S(-58,126) },
      { S(158, 47), S(176, -3), S( 64, 82), S( 59, 36) }
    }
  },
#endif
#ifdef LOSERS
  {
    { },
    { // Pawn
      { S(  0, 0), S(  0, 0), S(  0, 0), S( 0, 0) },
      { S(-11, 7), S(  6,-4), S(  7, 8), S( 3,-2) },
      { S(-18,-4), S( -2,-5), S( 19, 5), S(24, 4) },
      { S(-17, 3), S( -9, 3), S( 20,-8), S(35,-3) },
      { S( -6, 8), S(  5, 9), S(  3, 7), S(21,-6) },
      { S( -6, 8), S( -8,-5), S( -6, 2), S(-2, 4) },
      { S( -4, 3), S( 20,-9), S( -8, 1), S(-4,18) }
    },
    { // Knight
      { S(-143, -97), S(-96,-82), S(-80,-46), S(-73,-14) },
      { S( -83, -69), S(-43,-55), S(-21,-17), S(-10,  9) },
      { S( -71, -50), S(-22,-39), S(  0, -8), S(  9, 28) },
      { S( -25, -41), S( 18,-25), S( 43,  7), S( 47, 38) },
      { S( -26, -46), S( 16,-25), S( 38,  2), S( 50, 41) },
      { S( -11, -55), S( 37,-38), S( 56, -8), S( 71, 27) },
      { S( -62, -64), S(-17,-50), S(  5,-24), S( 14, 13) },
      { S(-195,-110), S(-66,-90), S(-42,-50), S(-29,-13) }
    },
    { // Bishop
      { S(-54,-68), S(-23,-40), S(-35,-46), S(-44,-28) },
      { S(-30,-43), S( 10,-17), S(  2,-23), S( -9, -5) },
      { S(-19,-32), S( 17, -9), S( 11,-13), S(  1,  8) },
      { S(-21,-36), S( 18,-13), S( 11,-15), S(  0,  7) },
      { S(-21,-36), S( 14,-14), S(  6,-17), S( -1,  3) },
      { S(-27,-35), S(  6,-13), S(  2,-10), S( -8,  1) },
      { S(-33,-44), S(  7,-21), S( -4,-22), S(-12, -4) },
      { S(-45,-65), S(-21,-42), S(-29,-46), S(-39,-27) }
    },
    { // Rook
      { S(-25, 0), S(-16, 0), S(-16, 0), S(-9, 0) },
      { S(-21, 0), S( -8, 0), S( -3, 0), S( 0, 0) },
      { S(-21, 0), S( -9, 0), S( -4, 0), S( 2, 0) },
      { S(-22, 0), S( -6, 0), S( -1, 0), S( 2, 0) },
      { S(-22, 0), S( -7, 0), S(  0, 0), S( 1, 0) },
      { S(-21, 0), S( -7, 0), S(  0, 0), S( 2, 0) },
      { S(-12, 0), S(  4, 0), S(  8, 0), S(12, 0) },
      { S(-23, 0), S(-15, 0), S(-11, 0), S(-5, 0) }
    },
    { // Queen
      { S( 0,-70), S(-3,-57), S(-4,-41), S(-1,-29) },
      { S(-4,-58), S( 6,-30), S( 9,-21), S( 8, -4) },
      { S(-2,-39), S( 6,-17), S( 9, -7), S( 9,  5) },
      { S(-1,-29), S( 8, -5), S(10,  9), S( 7, 17) },
      { S(-3,-27), S( 9, -5), S( 8, 10), S( 7, 23) },
      { S(-2,-40), S( 6,-16), S( 8,-11), S(10,  3) },
      { S(-2,-54), S( 7,-30), S( 7,-21), S( 6, -7) },
      { S(-1,-75), S(-4,-54), S(-1,-44), S( 0,-30) }
    },
    { // King
      { S(260,  0), S(313, 48), S(263, 75), S(188, 84) },
      { S(258, 42), S(298, 91), S(232,142), S(174,131) },
      { S(195, 81), S(240,136), S(171,167), S(105,163) },
      { S(173,103), S(181,166), S(144,166), S(106,176) },
      { S(146,104), S(174,159), S(112,196), S( 63,199) },
      { S(116, 90), S(157,150), S( 82,171), S( 39,169) },
      { S( 85, 44), S(127, 93), S( 62,114), S( 17,133) },
      { S( 63,  2), S( 89, 48), S( 47, 73), S(  0, 83) }
    }
  },
#endif
#ifdef RACE
  {
    { },
    { // Pawn
    },
    { // Knight
      { S(-237,-120), S(-56,-154), S(-138,-162), S(-100,-91) },
      { S(-104, -73), S(-27, -69), S(  19, -27), S( -30,-54) },
      { S(  51, -45), S( 29,  -1), S(  58, -25), S( 105, 35) },
      { S(  20,  27), S( 54, -27), S(  77,  59), S(125, 132) },
      { S(  32,  29), S( 75,  -2), S(  95, 123), S(130, 132) },
      { S(  16,  21), S( 31,  86), S( 108,  74), S(135, 142) },
      { S( -17,   0), S( 40,  51), S(  41, 116), S(  8,  74) },
      { S( -22, -42), S(-11, -22), S( -34,  47), S( 12,  97) }
    },
    { // Bishop
      { S(-45,-65), S(-21,-42), S(-29,-46), S(-39,-27) },
      { S(-23,-34), S( 17,-11), S(  6,-12), S( -2,  6) },
      { S( -7,-15), S( 26,  7), S( 22, 10), S( 12, 21) },
      { S(  9, -6), S( 44, 16), S( 36, 13), S( 29, 33) },
      { S( 19,  4), S( 58, 27), S( 51, 25), S( 40, 47) },
      { S( 31, 18), S( 67, 41), S( 61, 37), S( 51, 58) },
      { S( 30, 17), S( 70, 43), S( 62, 37), S( 51, 55) },
      { S( 16,  2), S( 47, 30), S( 35, 24), S( 26, 42) }
    },
    { // Rook
      { S(-23, 0), S(-15,  0), S(-11,  0), S( -5,  0) },
      { S(-2, 10), S( 14, 10), S( 18, 10), S( 22, 10) },
      { S(-1, 20), S( 13, 20), S( 20, 20), S( 22, 20) },
      { S( 8, 30), S( 23, 30), S( 30, 30), S( 31, 30) },
      { S(18, 40), S( 34, 40), S( 39, 40), S( 42, 40) },
      { S(29, 50), S( 41, 50), S( 46, 50), S( 52, 50) },
      { S(39, 60), S( 52, 60), S( 57, 60), S( 60, 60) },
      { S(45, 70), S( 54, 70), S( 54, 70), S( 61, 70) }
    },
    { // Queen
      { S(-1,-75), S(-4,-54), S(-1,-44), S( 0,-30) },
      { S( 8,-44), S(17,-20), S(17,-11), S(16,  3) },
      { S(18,-20), S(26,  4), S(28,  9), S(30, 23) },
      { S(27,  3), S(39, 25), S(38, 40), S(37, 53) },
      { S(39, 11), S(48, 35), S(50, 49), S(47, 57) },
      { S(48, 11), S(56, 33), S(59, 43), S(59, 55) },
      { S(56,  2), S(66, 30), S(69, 39), S(68, 56) },
      { S(70,  0), S(67, 13), S(66, 29), S(69, 41) }
    },
    { // King
      { S( 63,   2), S( 89, 48), S( 47, 73), S(  0, 83) },
      { S( 95,  54), S(137,103), S( 72,124), S( 27,143) },
      { S(136, 110), S(177,170), S(102,191), S( 59,189) },
      { S(176, 134), S(204,189), S(142,226), S( 93,229) },
      { S(213, 143), S(221,206), S(184,206), S(146,216) },
      { S(245, 131), S(290,186), S(221,217), S(155,213) },
      { S(318, 102), S(358,151), S(292,202), S(234,191) },
      { S(330,  70), S(383,118), S(333,145), S(258,154) }
    }
  },
#endif
#ifdef RELAY
  {
    { },
    { // Pawn
      { S(  0, 0), S(  0, 0), S(  0, 0), S( 0, 0) },
      { S(-11, 7), S(  6,-4), S(  7, 8), S( 3,-2) },
      { S(-18,-4), S( -2,-5), S( 19, 5), S(24, 4) },
      { S(-17, 3), S( -9, 3), S( 20,-8), S(35,-3) },
      { S( -6, 8), S(  5, 9), S(  3, 7), S(21,-6) },
      { S( -6, 8), S( -8,-5), S( -6, 2), S(-2, 4) },
      { S( -4, 3), S( 20,-9), S( -8, 1), S(-4,18) }
    },
    { // Knight
      { S(-143, -97), S(-96,-82), S(-80,-46), S(-73,-14) },
      { S( -83, -69), S(-43,-55), S(-21,-17), S(-10,  9) },
      { S( -71, -50), S(-22,-39), S(  0, -8), S(  9, 28) },
      { S( -25, -41), S( 18,-25), S( 43,  7), S( 47, 38) },
      { S( -26, -46), S( 16,-25), S( 38,  2), S( 50, 41) },
      { S( -11, -55), S( 37,-38), S( 56, -8), S( 71, 27) },
      { S( -62, -64), S(-17,-50), S(  5,-24), S( 14, 13) },
      { S(-195,-110), S(-66,-90), S(-42,-50), S(-29,-13) }
    },
    { // Bishop
      { S(-54,-68), S(-23,-40), S(-35,-46), S(-44,-28) },
      { S(-30,-43), S( 10,-17), S(  2,-23), S( -9, -5) },
      { S(-19,-32), S( 17, -9), S( 11,-13), S(  1,  8) },
      { S(-21,-36), S( 18,-13), S( 11,-15), S(  0,  7) },
      { S(-21,-36), S( 14,-14), S(  6,-17), S( -1,  3) },
      { S(-27,-35), S(  6,-13), S(  2,-10), S( -8,  1) },
      { S(-33,-44), S(  7,-21), S( -4,-22), S(-12, -4) },
      { S(-45,-65), S(-21,-42), S(-29,-46), S(-39,-27) }
    },
    { // Rook
      { S(-25, 0), S(-16, 0), S(-16, 0), S(-9, 0) },
      { S(-21, 0), S( -8, 0), S( -3, 0), S( 0, 0) },
      { S(-21, 0), S( -9, 0), S( -4, 0), S( 2, 0) },
      { S(-22, 0), S( -6, 0), S( -1, 0), S( 2, 0) },
      { S(-22, 0), S( -7, 0), S(  0, 0), S( 1, 0) },
      { S(-21, 0), S( -7, 0), S(  0, 0), S( 2, 0) },
      { S(-12, 0), S(  4, 0), S(  8, 0), S(12, 0) },
      { S(-23, 0), S(-15, 0), S(-11, 0), S(-5, 0) }
    },
    { // Queen
      { S( 0,-70), S(-3,-57), S(-4,-41), S(-1,-29) },
      { S(-4,-58), S( 6,-30), S( 9,-21), S( 8, -4) },
      { S(-2,-39), S( 6,-17), S( 9, -7), S( 9,  5) },
      { S(-1,-29), S( 8, -5), S(10,  9), S( 7, 17) },
      { S(-3,-27), S( 9, -5), S( 8, 10), S( 7, 23) },
      { S(-2,-40), S( 6,-16), S( 8,-11), S(10,  3) },
      { S(-2,-54), S( 7,-30), S( 7,-21), S( 6, -7) },
      { S(-1,-75), S(-4,-54), S(-1,-44), S( 0,-30) }
    },
    { // King
      { S(260,  0), S(313, 48), S(263, 75), S(188, 84) },
      { S(258, 42), S(298, 91), S(232,142), S(174,131) },
      { S(195, 81), S(240,136), S(171,167), S(105,163) },
      { S(173,103), S(181,166), S(144,166), S(106,176) },
      { S(146,104), S(174,159), S(112,196), S( 63,199) },
      { S(116, 90), S(157,150), S( 82,171), S( 39,169) },
      { S( 85, 44), S(127, 93), S( 62,114), S( 17,133) },
      { S( 63,  2), S( 89, 48), S( 47, 73), S(  0, 83) }
    }
  },
#endif
#ifdef THREECHECK
  {
    { },
    { // Pawn
      { S(  0, 0), S(  0, 0), S(  0, 0), S( 0, 0) },
      { S(-11, 7), S(  6,-4), S(  7, 8), S( 3,-2) },
      { S(-18,-4), S( -2,-5), S( 19, 5), S(24, 4) },
      { S(-17, 3), S( -9, 3), S( 20,-8), S(35,-3) },
      { S( -6, 8), S(  5, 9), S(  3, 7), S(21,-6) },
      { S( -6, 8), S( -8,-5), S( -6, 2), S(-2, 4) },
      { S( -4, 3), S( 20,-9), S( -8, 1), S(-4,18) }
    },
    { // Knight
      { S(-143, -97), S(-96,-82), S(-80,-46), S(-73,-14) },
      { S( -83, -69), S(-43,-55), S(-21,-17), S(-10,  9) },
      { S( -71, -50), S(-22,-39), S(  0, -8), S(  9, 28) },
      { S( -25, -41), S( 18,-25), S( 43,  7), S( 47, 38) },
      { S( -26, -46), S( 16,-25), S( 38,  2), S( 50, 41) },
      { S( -11, -55), S( 37,-38), S( 56, -8), S( 71, 27) },
      { S( -62, -64), S(-17,-50), S(  5,-24), S( 14, 13) },
      { S(-195,-110), S(-66,-90), S(-42,-50), S(-29,-13) }
    },
    { // Bishop
      { S(-54,-68), S(-23,-40), S(-35,-46), S(-44,-28) },
      { S(-30,-43), S( 10,-17), S(  2,-23), S( -9, -5) },
      { S(-19,-32), S( 17, -9), S( 11,-13), S(  1,  8) },
      { S(-21,-36), S( 18,-13), S( 11,-15), S(  0,  7) },
      { S(-21,-36), S( 14,-14), S(  6,-17), S( -1,  3) },
      { S(-27,-35), S(  6,-13), S(  2,-10), S( -8,  1) },
      { S(-33,-44), S(  7,-21), S( -4,-22), S(-12, -4) },
      { S(-45,-65), S(-21,-42), S(-29,-46), S(-39,-27) }
    },
    { // Rook
      { S(-25, 0), S(-16, 0), S(-16, 0), S(-9, 0) },
      { S(-21, 0), S( -8, 0), S( -3, 0), S( 0, 0) },
      { S(-21, 0), S( -9, 0), S( -4, 0), S( 2, 0) },
      { S(-22, 0), S( -6, 0), S( -1, 0), S( 2, 0) },
      { S(-22, 0), S( -7, 0), S(  0, 0), S( 1, 0) },
      { S(-21, 0), S( -7, 0), S(  0, 0), S( 2, 0) },
      { S(-12, 0), S(  4, 0), S(  8, 0), S(12, 0) },
      { S(-23, 0), S(-15, 0), S(-11, 0), S(-5, 0) }
    },
    { // Queen
      { S( 0,-70), S(-3,-57), S(-4,-41), S(-1,-29) },
      { S(-4,-58), S( 6,-30), S( 9,-21), S( 8, -4) },
      { S(-2,-39), S( 6,-17), S( 9, -7), S( 9,  5) },
      { S(-1,-29), S( 8, -5), S(10,  9), S( 7, 17) },
      { S(-3,-27), S( 9, -5), S( 8, 10), S( 7, 23) },
      { S(-2,-40), S( 6,-16), S( 8,-11), S(10,  3) },
      { S(-2,-54), S( 7,-30), S( 7,-21), S( 6, -7) },
      { S(-1,-75), S(-4,-54), S(-1,-44), S( 0,-30) }
    },
    { // King
      { S(260,  0), S(313, 48), S(263, 75), S(188, 84) },
      { S(258, 42), S(298, 91), S(232,142), S(174,131) },
      { S(195, 81), S(240,136), S(171,167), S(105,163) },
      { S(173,103), S(181,166), S(144,166), S(106,176) },
      { S(146,104), S(174,159), S(112,196), S( 63,199) },
      { S(116, 90), S(157,150), S( 82,171), S( 39,169) },
      { S( 85, 44), S(127, 93), S( 62,114), S( 17,133) },
      { S( 63,  2), S( 89, 48), S( 47, 73), S(  0, 83) }
    }
  },
#endif
};

#ifdef CRAZYHOUSE
Score psq[VARIANT_NB][PIECE_NB][SQUARE_NB+1];
const Score inHandBonus[PIECE_TYPE_NB] = {
    S(0, 0), S(52, 13), S(66, 30), S(4, 4), S(13, 3), S(25, 9)
};
#else
Score psq[VARIANT_NB][PIECE_NB][SQUARE_NB];
#endif

#undef S

// init() initializes piece-square tables: the white halves of the tables are
// copied from Bonus[] adding the piece value, then the black halves of the
// tables are initialized by flipping and changing the sign of the white scores.
void init() {

  for (Variant var = CHESS_VARIANT; var < VARIANT_NB; ++var)
      for (Piece pc = W_PAWN; pc <= W_KING; ++pc)
      {
          PieceValue[var][MG][~pc] = PieceValue[var][MG][pc];
          PieceValue[var][EG][~pc] = PieceValue[var][EG][pc];

          Score v = make_score(PieceValue[var][MG][pc], PieceValue[var][EG][pc]);

          for (Square s = SQ_A1; s <= SQ_H8; ++s)
          {
              File f = std::min(file_of(s), FILE_H - file_of(s));
              psq[var][ pc][ s] = v + Bonus[var][pc][rank_of(s)][f];
#ifdef RACE
              if (var == RACE_VARIANT)
                  psq[var][~pc][horizontal_flip(s)] = -psq[var][pc][s];
              else
#endif
              psq[var][~pc][~s] = -psq[var][pc][s];
          }
#ifdef CRAZYHOUSE
          psq[var][ pc][SQ_NONE] = v + inHandBonus[type_of(pc)];
          psq[var][~pc][SQ_NONE] = -psq[var][pc][SQ_NONE];
#endif
      }
}

} // namespace PSQT
